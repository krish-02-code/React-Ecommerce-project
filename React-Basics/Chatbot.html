<!DOCTYPE html>
<html>

<head>
    <title>ChatBot</title>
    <style>
        body{
            font-family: Arial;
            margin:0px;
        }
     .send-button{
        background-color: rgb(23, 135, 84);
        border:none;
        color: white;
        border-radius: 8px;
        padding: 12px 20px;
        margin-left: 10px;
        font-size: 15px;
        cursor: pointer;
     }
     .chat-input{
        padding: 12px 15px;
        border-radius: 10px;
        border-width: 1px;
        font-size: 15px;

        flex-grow: 1;
     }
     .chat-input-container{
        display: flex;
        margin-bottom: 60px;
        /* width: 1fr 20px; */
     }
     .app-container{
        max-width: 600px;
        margin-left: auto;
        margin-right: auto;
        height: 100vh;
        display: flex;
        flex-direction: column;
     }
     .chat-message-robot{
        display: flex;
        align-items: start;
       
     }
     .chat-message-user{
        display: flex;
       align-items: start;
       justify-content: end;
       
     }
     .chat-message-text{
        background-color: rgb(238, 238, 238);
        padding: 15px 20px;
        border-radius: 10px;
        margin-right: 10px;
        margin-left: 10px;
        margin-bottom: 20px;
        max-width: 300px;
     }
     .chat-message-profile{
        width: 40px;
     }
     .chat-messages-container{
        flex-grow: 1; 
        margin-top: 20px;
        overflow: scroll;
        scrollbar-width: none;
     }
     .Starting-Header-message{
        align-items: center;
        color: rgb(120,120,120);
        font-weight: 500px;
     }
    </style>
</head>

<body>
    <div class="js-container"></div>

    <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
    <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>

    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <script src="https://unpkg.com/supersimpledev/babel.js"></script>
    <script type="text/babel">

       function ChatInput({chatMessages,setChatMessages}) {
            const [inputText, setInputText] = React.useState('');
            const [isLoading,setIsLoading] = React.useState(false);

            function saveInputText(event) {
                setInputText(event.target.value);
            }

            async function sendMessage(){
                //  console.log(inputText);
                if(inputText === '' || isLoading){
                    return;
                }
                
                setIsLoading(true);
                setInputText('');
                
                const newChatMessages = [
                    ...chatMessages,
                    {
                        message: inputText,
                        sender: 'user',
                        id: crypto.randomUUID()
                    }
                ];

                // setChatMessages(newChatMessages);

                setChatMessages([
                    ...newChatMessages,
                    {
                        message: "Loading...",
                        sender: 'robot',
                        id: crypto.randomUUID()
                    }
                ]);

                const response = await Chatbot.getResponseAsync(inputText);

                 setChatMessages([
                    ...newChatMessages,
                    {
                        message: response,
                        sender: 'robot',
                        id: crypto.randomUUID()
                    }
                ]);
                // setInputText('');
                setIsLoading(false);
            }
            
            function send(event){
                if(event.key === 'Escape'){
                    setInputText('');
                }
                if(event.key === 'Enter'){
                    sendMessage();
                }
            }
           
            return (
                <div className="chat-input-container">
                    <input
                        type="text"
                        placeholder="Send a message to ChatBot"
                        size="30"
                        onChange={saveInputText}
                        value ={inputText}
                        onKeyDown={send}
                        className="chat-input"
                    >
                    </input>

                    <button 
                    className ="send-button"
                    onClick={sendMessage}>
                        Send
                    </button>
                </div>
            );
        }

        function ChatMessage({ message, sender }) {
            // const message = props.message;
            // const sender = props.sender;
            // const {message,sender} = props;

            // if (sender === 'robot') {
            //     return (
            //         <div>
            //             <img src="robot.png" alt="" width="40" />
            //             {message}
            //         </div>
            //     );
            // }

            return (
                <div className={sender === 'robot' ? 'chat-message-robot' : 'chat-message-user'}>
                    {sender === 'robot' && <img src="robot.png" alt=""  className="chat-message-profile"/>}
                     <div className="chat-message-text">{message}</div>
                    {sender === 'user' && <img src="user.png" alt="" className="chat-message-profile"/>}
                </div>
            )
        }

        function ChatMessages({chatMessages}) {
            const chatMessagesRef = React.useRef(null);

            React.useEffect(()=>{
              const containerElem = chatMessagesRef.current;
              if(containerElem){
                containerElem.scrollTop = containerElem.scrollHeight;
              }
            },[chatMessages]);
            // const [chatMessages,setChatMessages] = arr;
            // const chatMessages = arr[0];
            //  const setChatMessages = arr[1];

            // const chatMess ageComponents = chatMessages.map((chatMessages)=>{
            //    return (
            //     <ChatMessage message={chatMessages.message} sender={chatMessages.sender} />
            //    );
            // })

            //  function sendMessage(){
            //       setChatMessages([
            //         ...chatMessages,
            //          {
            //             message:'test',
            //             sender:'user',
            //             id:crypto.randomUUID()
            //          }
            //       ]);


            //    chatMessages.push({
            //     message:'test',
            //     sender:'user',
            //     id:crypto.randomUUID()
            //    });
            //    console.log(chatMessages);

            return (
                <div className="chat-messages-container" ref={chatMessagesRef}>
                    {   
                        chatMessages.map((chatMessages) =>{
                        return (
                            <ChatMessage
                                message={chatMessages.message}
                                sender={chatMessages.sender}
                                key={chatMessages.id} />
                         )
                        })
                    }
                </div>
            )
        }

        function App() {
              const [chatMessages, setChatMessages] = React.useState([]);
            return (
                <div className="app-container">
                    {chatMessages.length == 0 && <p className="Starting-Header-message">Welcome to the ChatBot project! Send a message using the text box below </p>}
                    <ChatMessages chatMessages={chatMessages} />
                     <ChatInput chatMessages={chatMessages} setChatMessages={setChatMessages}/>
                </div>
            );
        }

        // const app = (
        //     <>
        //         <ChatInput />
        //         <ChatMessage message="hello chatBot" sender="user" />
        //         <ChatMessage message="Hello! How can I help you?" sender="robot" />
        //         <ChatMessage message="can you get me todays date?" sender="user" />
        //         <ChatMessage message="Today is December 30" sender="robot" />

        //     </>
        // );

        const container = document.querySelector('.js-container');
        // ReactDOM.createRoot(container).render(App());
        ReactDOM.createRoot(container).render(<App />);

    </script>
</body>

</html>